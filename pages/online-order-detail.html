<!-- 在线预订详情 -->
<!DOCTYPE html>
<html>
<head>
	<title>在线预订详情页</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="../resources/css/reset.css">
	<link rel="stylesheet" type="text/css" href="../resources/css/common.css">
	<link rel="stylesheet" type="text/css" href="../resources/css/online-order.css">
	<script type="text/javascript" src="../resources/js/jquery.js"></script>
	<script type="text/javascript" src="../resources/js/laydate/laydate.js"></script>
	<script type="text/javascript" src="../resources/js/layer/layer.js"></script>
</head>
<body>
	<!--#include file="/pages/header.html"  -->
	<div class="content">
		<div class="top-img">
			<img src="../resources/img/delete/online-top-bg.jpg">
			<div class="sub-nav in-detail">
				<div>
					<a href="javascript:;" class="to-hide" isHidden="no">隐藏空房</a>
				</div>
			</div>
		</div>
		<div class="clearfix">
			<form class="calendar">
				开始日：<input class="laydate-icon" id="start" name="startday" value="2016-06-01"> 
				结束日：<input class="laydate-icon" id="end" name="endday" value="2016-06-02">
				<button type="submit">查询</button>
			</form>
			<ul class="room-show">
				<li>
					<div class="detail-img">
						<img src="../resources/img/delete/u27.png">
					</div>
					<div class="detail-info">
						<h1>双人间<br /><span>(面积20㎡)</span></h1>
						<h3><span>CNY:1200.60/</span>每晚<em>含税费</em></h3>
						<a href="javascript:;" class="sure-order" roomId="3">预定</a>
					</div>
				</li>
				<li class="no-room">
					<div class="detail-img">
						<img src="../resources/img/delete/u27.png">
					</div>
					<div class="detail-info">
						<h1>双人间<br /><span>(面积20㎡)</span></h1>
						<h3><span>CNY:1200.60/</span>每晚<em>含税费</em></h3>
						<a href="javascript:;">已预定</a>
					</div>
				</li>
				<li>
					<div class="detail-img">
						<img src="../resources/img/delete/u27.png">
					</div>
					<div class="detail-info">
						<h1>双人间<br /><span>(面积20㎡)</span></h1>
						<h3><span>CNY:1200.60/</span>每晚<em>含税费</em></h3>
						<a href="javascript:;" class="sure-order" roomId="2">预定</a>
					</div>
				</li>
			</ul>
		</div>
		
	</div>
	<!--#include file="/pages/footer.html"  -->
	<script type="text/javascript">
		$('.to-hide').click(function(ev){
			if($(ev.target).attr('isHidden') == 'no'){
				$('.no-room').hide();
				$(ev.target).attr('isHidden','yes');
				$(ev.target).text('取消隐藏');
			}else{
				$('.no-room').show();
				$(ev.target).attr('isHidden','no');
				$(ev.target).text('隐藏空房');
			}
		});
		var	min = $('#start').val() || laydate.now();
		var start = {
		    elem: '#start',
		    format: 'YYYY-MM-DD',
		    min: min, //设定最小日期为当前日期
		    max: '2099-06-16 23:59:59', //最大日期
		    istime: true,
		    istoday: false,
		    choose: function(datas){
		         end.min = datas; //开始日选好后，重置结束日的最小日期
		         end.start = datas //将结束日的初始值设定为开始日
		    }
		};
		var end = {
		    elem: '#end',
		    format: 'YYYY-MM-DD',
		    min: min,
		    max: '2099-06-16 23:59:59',
		    istime: true,
		    istoday: false,
		    choose: function(datas){
		        start.max = datas; //结束日选好后，重置开始日的最大日期
		    }
		};
		laydate(start);
		laydate(end);
		
		var 
			index;//弹出层的序号
		$('.sure-order').click(function(ev){
			var
				formHtml =  '<div>'+
							'<span>开始日:</span><input name="startday"'+' value="'+ $('#start').val()+'" readonly="true" />'+
						'</div>'+
						'<div>'+
							'<span>结束日:</span><input name="endday" value="'+$('#end').val()+'"  readonly="true"/>'+
						'</div>'+
						'<div>'+
							'<span>姓名:</span><input name="userName" class="user-name">'+
						'</div>'+
						'<div>'+
							'<span>电话号码:</span><input name="telephone" class="telephone">'+
						'</div>'+
						'<div>'+
							'<button type="submit">提交</button>'+
						'</div>',
				roomId = $(ev.target).attr('roomId'),
				roomName = $(ev.target).prev().prev().text();
			
			formHtml = '<form class="order-info" id="J_orderInfo">'+'<h1>'+roomName+'<h1/>'+formHtml;
			formHtml = formHtml + '<input type=hidden value="'+roomId+'" name="roomId"/></form>',
			index = layer.open({
			  type: 1,
			  skin: 'layui-layer-rim', 
			  area: ['600px', '430px'], 
			  content: formHtml
			});
		})

		$(document).on('submit','#J_orderInfo',function(ev) {
			var 
				param,
				regex = /^1[3|4|5|7|8][0-9]{9}$/;
			ev.preventDefault();
			if($('.user-name').val() == ''){
				$('.user-name').css('border-color','red');
			}else if($('.telephone').val() == ''){
				$('.telephone').css('border-color','red');
			}else if(!regex.test($('.telephone').val())){
				$('.telephone').val('请输入正确的电话号码格式!');
			}
			else{
				param = $(this).serialize();
				$.ajax({
					type:'get',
					url:'/mock/succeed.json',
					data:param
				}).done(function(msg){
					 if(msg.code == 0){
					 	layer.close(index);
					 	layer.open({
						  type: 1,
						  skin: 'layui-layer-rim', 
						  area: ['600px', '430px'], 
						  content: '<p style="text-align:justify;font-size:20px;color:#999;padding:80px;">您的预约已提交成功！工作人员将在10分钟之内与您取得联系，请您保持通话畅通状态！</p>'
						});
					 }
					 if(msg.code == 1){
					 	layer.close(index);
					 	layer.open({
						  type: 1,
						  skin: 'layui-layer-rim', 
						  area: ['600px', '430px'], 
						  content: '<p style="text-align:justify;font-size:20px;color:#999;padding:80px;">抱歉，预定不成功，请稍后再次预定</p>'
						});
					 }
				}).fail(function(msg){
					 console.log(msg)
				})
			}
			
		});

		$(document).on('focus', 'input' ,function (ev) {
			 $(ev.target).css('border-color','#999');
			 if($(ev.target).hasClass('telephone')){
			 	$(ev.target).val('');
			 }
		})
		
	</script>
</body>
</html>