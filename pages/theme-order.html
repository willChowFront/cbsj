<!-- 主题预定 -->
<!DOCTYPE html>
<html>
<head>
	<title>在线预订详情页</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="../resources/css/reset.css">
	<link rel="stylesheet" type="text/css" href="../resources/css/online-order.css">
	<link rel="stylesheet" type="text/css" href="../resources/css/common.css">
	<link rel="stylesheet" type="text/css" href="../resources/css/flexslider.css">
	<script type="text/javascript" src="../resources/js/jquery.js"></script>
	<script type="text/javascript" src="../resources/js/laydate/laydate.js"></script>
	<script type="text/javascript" src="../resources/js/layer/layer.js"></script>
</head>
<body>
	<!--#include file="/pages/header.html"  -->
	<div class="content">
		<div class="top-img">
			<img src="../resources/img/delete/online-top-bg.jpg">
			<div class="sub-nav">
				<div>
					<a href="javascript:;" class="current"><span>主题式户型</span></a>
					<a href="javascript:;"><span>家庭式户型</span></a>
				</div>
			</div>
		</div>
		<div  class="themes">
			<a href="javascript:;" class="db-theme current-theme">东北主题</a>
			<a href="javascript:;" class="dw-theme">动物主题</a>
			<a href="javascript:;" class="cz-theme">朝族主题</a>
			<a href="javascript:;" class="sl-theme">森林主题</a>
		</div>
		<div class="theme-show">
			<h1 class="db-theme">东北主题式精品民宿</h1>
			<img src="../resources/img/delete/u27.png">
			<p class="db-theme">房型设计突出长白山本地东北本地文化特色，体验东北风情。尽享优质环境的同时，体验浓郁的北风情。</p>
		</div>
		<!-- <div class="theme-show">
			<h1 class="dw-theme">动物主题式精品民宿</h1>
			<img src="../resources/img/delete/u27.png">
			<p class="dw-theme">房型设计突出长白山本地东北本地文化特色，体验东北风情。尽享优质环境的同时，体验浓郁的北风情。</p>
		</div> -->
		<!-- <div class="theme-show">
			<h1 class="cz-theme">朝族主题式精品民宿</h1>
			<img src="../resources/img/delete/u27.png">
			<p class="cz-theme">房型设计突出长白山本地东北本地文化特色，体验东北风情。尽享优质环境的同时，体验浓郁的北风情。</p>
		</div> -->
		<!-- <div class="theme-show">
			<h1 class="sl-theme">森林主题式精品民宿</h1>
			<img src="../resources/img/delete/u27.png">
			<p class="sl-theme">房型设计突出长白山本地东北本地文化特色，体验东北风情。尽享优质环境的同时，体验浓郁的北风情。</p>
		</div> -->
		<div class="clearfix">
			<form class="calendar">
				开始日：<input class="laydate-icon" id="start" name="startday" value="2016-06-01"> 
				结束日：<input class="laydate-icon" id="end" name="endday" value="2016-06-02">
				<button type="submit">查询</button>
			</form>
			<ul class="room-show">
				<li>
					<div class="clearfix">
						<div class="flexslider detail-img">
					      <ul class="slides">
					        <li>
					       		<img src="../resources/img/delete/u27.png">
					        </li>
					        <li>
					         	<img src="../resources/img/delete/u38.jpg">
					        </li>
					        <li>
					          <img src="../resources/img/delete/u78.png">
					        </li>
					        <li>
					          <img src="../resources/img/delete/u59.jpg">
					        </li>
					      </ul>
					    </div>
						<div class="detail-info">
							<h1>长白山北坡时尚舒适1卧公寓</h1>
							<div class="info-table">
								<span>可住：4人</span>
								<span>空调：无</span>
								<span>宽带：无</span>
								<span>电视：有</span>
							</div>
							<h3><span>CNY:120.60/</span>每晚<em>含税费</em></h3>
							<a href="javascript:;" class="sure-order" roomId="3" themeId="1">预定</a>
						</div>
					</div>
					<p>公寓位于长白山保护开发区池北区天福街，宽敞明亮，设施齐全，环境温馨。可容纳4人居住（有小炕）。</p>
				</li>
				<li id="J_noRoom">
					<div class="clearfix">
						<div class="flexslider detail-img">
					      <ul class="slides">
					        <li>
					       		<img src="../resources/img/delete/u27.png">
					        </li>
					        <li>
					         	<img src="../resources/img/delete/u38.jpg">
					        </li>
					        <li>
					          <img src="../resources/img/delete/u78.png">
					        </li>
					        <li>
					          <img src="../resources/img/delete/u59.jpg">
					        </li>
					      </ul>
					    </div>
						<div class="detail-info">
							<h1>长白山北坡时尚舒适1卧公寓</h1>
							<div class="info-table">
								<span>可住：4人</span>
								<span>空调：无</span>
								<span>宽带：无</span>
								<span>电视：有</span>
							</div>
							<h3><span>CNY:120.60/</span>每晚<em>含税费</em></h3>
							<a href="javascript:;"  class="no-room">已预定</a>
						</div>
					</div>
					<p>公寓位于长白山保护开发区池北区天福街，宽敞明亮，设施齐全，环境温馨。可容纳4人居住（有小炕）。</p>
				</li><li>
					<div class="clearfix">
						<div class="flexslider detail-img">
					      <ul class="slides">
					        <li>
					       		<img src="../resources/img/delete/u27.png">
					        </li>
					        <li>
					         	<img src="../resources/img/delete/u38.jpg">
					        </li>
					        <li>
					          <img src="../resources/img/delete/u78.png">
					        </li>
					        <li>
					          <img src="../resources/img/delete/u59.jpg">
					        </li>
					      </ul>
					    </div>
						<div class="detail-info">
							<h1>长白山北坡时尚舒适1卧公寓</h1>
							<div class="info-table">
								<span>可住：4人</span>
								<span>空调：无</span>
								<span>宽带：无</span>
								<span>电视：有</span>
							</div>
							<h3><span>CNY:120.60/</span>每晚<em>含税费</em></h3>
							<a href="javascript:;" class="sure-order" roomId="3" themeId="1">预定</a>
						</div>
					</div>
					<p>公寓位于长白山保护开发区池北区天福街，宽敞明亮，设施齐全，环境温馨。可容纳4人居住（有小炕）。</p>
				</li>
			</ul>
		</div>
		
	</div>
	<!--#include file="/pages/footer.html"  -->
	<script type="text/javascript">
		$('.to-hide').click(function(ev){
			if($(ev.target).attr('isHidden') == 'no'){
				$('#J_noRoom').hide();
				$(ev.target).attr('isHidden','yes');
				$(ev.target).text('取消隐藏');
			}else{
				$('#J_noRoom').show();
				$(ev.target).attr('isHidden','no');
				$(ev.target).text('隐藏空房');
			}
		});
		var	min = $('#start').val() || laydate.now();
		var start = {
		    elem: '#start',
		    format: 'YYYY-MM-DD',
		    min: min, //设定最小日期为当前日期
		    max: '2099-06-16 23:59:59', //最大日期
		    istime: true,
		    istoday: false,
		    choose: function(datas){
		         end.min = datas; //开始日选好后，重置结束日的最小日期
		         end.start = datas //将结束日的初始值设定为开始日
		    }
		};
		var end = {
		    elem: '#end',
		    format: 'YYYY-MM-DD',
		    min: min,
		    max: '2099-06-16 23:59:59',
		    istime: true,
		    istoday: false,
		    choose: function(datas){
		        start.max = datas; //结束日选好后，重置开始日的最大日期
		    }
		};
		laydate(start);
		laydate(end);
		
		var 
			isSuccess = false,//是否预定成功
			index;//弹出层的序号
		$('.sure-order').click(function(ev){
			var
				formHtml =  '<div class="one-row">'+
							'<span>开始日期:</span><input name="startday"'+' value="'+ $('#start').val()+'" readonly="true" />'+
						'</div>'+
						'<div class="one-row">'+
							'<span>结束日期:</span><input name="endday" value="'+$('#end').val()+'"  readonly="true"/>'+
						'</div>'+
						'<div>'+
							'<span>姓名:</span><input name="userName" class="user-name">'+
						'</div>'+
						'<div>'+
							'<span>电话号码:</span><input name="telephone" class="telephone">'+
						'</div>'+
						'<div>'+
							'<button type="submit">提交</button>'+
						'</div>',
				roomId = $(ev.target).attr('roomId'),
				themeId = $(ev.target).attr('themeId'),
				roomName = $(ev.target).prev().prev().prev().text();
			
			formHtml = '<form class="order-info clearfix" id="J_orderInfo">'+'<h1>'+roomName+'</h1>'+formHtml;
			formHtml = formHtml + '<input type=hidden value="'+themeId+'" name="themeId"/>';
			formHtml = formHtml + '<input type=hidden value="'+roomId+'" name="roomId"/></form>';
			index = layer.open({
			  type: 1,
			  skin: 'layui-layer-rim', 
			  area: ['600px', '430px'], 
			  content: formHtml
			});
		})

		$(document).on('submit','#J_orderInfo',function(ev) {
			var 
				param,
				regex = /^1[3|4|5|7|8][0-9]{9}$/;
			ev.preventDefault();
			if($('.user-name').val() == ''){
				$('.user-name').css('border-color','red');
			}else if($('.telephone').val() == ''){
				$('.telephone').css('border-color','red');
			}else if(!regex.test($('.telephone').val())){
				$('.telephone').val('请输入正确的电话号码格式!');
			}
			else{
				param = $(this).serialize();
				$.ajax({
					type:'get',
					url:'/mock/succeed.json',
					data:param,
					dataType:'json' 
				}).done(function(msg){
					 if(msg.code == 0){
					 	isSuccess = true;
					 	layer.close(index);
					 	layer.open({
						  type: 1,
						  skin: 'layui-layer-rim', 
						  area: ['600px', '430px'], 
						  content: '<p style="text-align:justify;font-size:20px;color:#999;padding:80px;">您的预约已提交成功！工作人员将在10分钟之内与您取得联系，请您保持通话畅通状态！</p>'
						});
					 }
					 if(msg.code == 1){
					 	layer.close(index);
					 	layer.open({
						  type: 1,
						  skin: 'layui-layer-rim', 
						  area: ['600px', '430px'], 
						  content: '<p style="text-align:justify;font-size:20px;color:#999;padding:80px;">抱歉，预定不成功，请稍后再次预定</p>'
						});
					 }
				}).fail(function(msg){
					 console.log(msg)
				})
			}
			
		});

		$(document).on('click','.layui-layer-close',function(ev){
			if(isSuccess){
				window.location.reload();
			}
		});

		$(document).on('focus', 'input' ,function (ev) {
			 $(ev.target).css('border-color','#999');
			 if($(ev.target).hasClass('telephone')){
			 	$(ev.target).val('');
			 }
		});
		
	</script>

	<script src="../resources/js/jquery.flexslider.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			$(window).load(function() {
			  $('.flexslider').flexslider({
			    animation: "slide"
			  });
			});
		})
		
	</script>
</body>
</html>